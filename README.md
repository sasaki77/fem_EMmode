# fem_EMmode
## 概要
このプログラムは有限要素法を用いて電磁場の周波数解析を
行うものである。

加速器で使用する加速空洞の解析を行うことを想定している。

[DT_mesher](https://github.com/sasaki77/DT_mesher)
を実行して得られたメッシュ情報を利用して解析を行う。

今のところ，Macでの動作確認しかしていないため，他の環境で使用した場合の動作を
保証することはできない。

## ファイル構成
このプログラムは以下の2種類のプログラムを含んでいる。

* fem：有限要素法を利用して電磁場の周波数解析を行うプログラム
* femvis：femの結果をOpenGLで表示するプログラム

上の2つのプログラムはそれぞれ，fem・femvisのディレクトリに入っている。

mesherとmeshvisはbinディレクトリに入れて使用することを推奨する。

その他，docディレクトリにはプログラムのクラス構成図・DT_mesherを含めた
簡単な使用方法が含まれている。

## コンパイル
femとfemvisディレクトリ内で
```bash
make
```
を実行することでそれぞれのプログラムをコンパイルすることが出来る。

このプロジェクトのトップにもMakefileがある。

トップでmakeを実行するとfem・femvisのコンパイルを実行し，
その実行ファイルをbinディレクトリに格納するようになっている。

実際に使用する際はトップでのmakeを推奨する。

## 使用方法
### fem(有限要素法解析)
予めDT_mesherで作成した以下のファイルを用意しておく。

* "*.bc"：境界条件の情報ファイル
* "*.elem":節点と要素の情報ファイル

ここでは"sample.bc"，"sample.elem"を例に取る。

実行ファイル"fem"を次のように実行する。

```bash
./fem sample
```

引数として渡すのは，入力ファイルの".bc",
".elem"を取り除いたものである。

実行し，有限要素法での解析に成功すると次のような表示が現れる。

```bash
input power [J] >>
```

これは加速空洞へどれだけのパワーを入力するかを決定する。

このパワーは加速空洞内での電磁場の大きさの計算，空洞でのロスを決定
するのに使用される。

パワーを入力すると次のように加速空洞のパラメータが表示される。

```bash
----------------------------------------
 nodenum    = 103
 edge size  = 0.104005
 area size  = 0.00455894
 lambda     = 7.55478
 frequency  = 1.31145e+08
 power loss = 9832.51
 Q          = 83804.5
 E0         = 513575
 R          = 2.68252e+07
----------------------------------------
```

解析した結果は拡張子が".out"として出力される。

".out"には次のような情報が含まれる。

* 解析時間
* 節点の情報 
* 要素の情報
* 共振周波数
* Q値
* シャントインピーダンス

今回の場合は"sample.out"が出力されることになる。

### femvis（有限要素解析の結果描画）
femvisはfemで解析した結果を描画するのに用いられるプログラムである。

描画にはfemの解析結果が含まれる".out"を利用する。

例えば，"sample.out"の結果を描画するには次のように実行する。

```bash
./femvis sample
```

操作方法は次の通りである。

* q:閉じる
* s:画面をepsファイルで保存
* v:電場ベクトルの描画 ON・OFF
